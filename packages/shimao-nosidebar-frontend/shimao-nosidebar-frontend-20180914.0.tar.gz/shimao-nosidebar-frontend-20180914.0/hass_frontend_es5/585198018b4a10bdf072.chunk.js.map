{"version":3,"sources":["webpack:///./node_modules/@polymer/paper-dialog-behavior/paper-dialog-behavior.js","webpack:///./node_modules/@polymer/paper-dialog-behavior/paper-dialog-shared-styles.js","webpack:///./src/mixins/dialog-mixin.js","webpack:///./src/dialogs/ha-voice-command-dialog.js"],"names":["__webpack_require__","d","__webpack_exports__","PaperDialogBehaviorImpl","PaperDialogBehavior","_polymer_iron_overlay_behavior_iron_overlay_behavior_js__WEBPACK_IMPORTED_MODULE_1__","_polymer_polymer_lib_legacy_polymer_dom_js__WEBPACK_IMPORTED_MODULE_2__","hostAttributes","role","tabindex","properties","modal","type","Boolean","value","__readied","observers","listeners","tap","ready","this","__prevNoCancelOnOutsideClick","noCancelOnOutsideClick","__prevNoCancelOnEscKey","noCancelOnEscKey","__prevWithBackdrop","withBackdrop","_modalChanged","readied","_updateClosingReasonConfirmed","confirmed","closingReason","_onDialogClick","event","path","Object","b","i","l","indexOf","target","hasAttribute","close","stopPropagation","a","$_documentContainer","document","createElement","setAttribute","innerHTML","head","appendChild","content","_polymer_polymer_lib_utils_mixin_js__WEBPACK_IMPORTED_MODULE_0__","superClass","_mixinBehaviors","_class","instance","Constructor","TypeError","__proto__","getPrototypeOf","apply","arguments","subClass","prototype","create","constructor","enumerable","writable","configurable","setPrototypeOf","_polymer_polymer_lib_legacy_class_js__WEBPACK_IMPORTED_MODULE_2__","_events_mixin__WEBPACK_IMPORTED_MODULE_3__","_polymer_paper_dialog_behavior_paper_dialog_behavior_js__WEBPACK_IMPORTED_MODULE_1__","_createClass","key","get","603","module","r","_polymer_polymer_lib_utils_html_tag_js__WEBPACK_IMPORTED_MODULE_3__","_polymer_polymer_polymer_element_js__WEBPACK_IMPORTED_MODULE_4__","_mixins_dialog_mixin_js__WEBPACK_IMPORTED_MODULE_5__","defineProperties","props","length","descriptor","defineProperty","protoProps","staticProps","_templateObject","freeze","raw","HaVoiceCommandDialog","recognition","webkitSpeechRecognition","onstart","results","final","interim","bind","onerror","abort","text","push","who","error","onend","hass","callApi","then","response","speech","plain","set","_conversation","onresult","oldResults","finalTranscript","interimTranscript","ind","resultIndex","isFinal","transcript","initRecognition","start","_this2","setTimeout","$","messages","scrollTop","scrollHeight","dialog","fire","newVal","startListening","message","observer","Array","customElements","define"],"mappings":"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","file":"585198018b4a10bdf072.chunk.js","sourcesContent":["/**\n@license\nCopyright (c) 2015 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\nimport '@polymer/polymer/polymer-legacy.js';\n\nimport {IronOverlayBehavior} from '@polymer/iron-overlay-behavior/iron-overlay-behavior.js';\nimport {dom} from '@polymer/polymer/lib/legacy/polymer.dom.js';\n\n/**\n  Use `Polymer.PaperDialogBehavior` and `paper-dialog-shared-styles.html` to\n  implement a Material Design dialog.\n\n  For example, if `<paper-dialog-impl>` implements this behavior:\n\n      <paper-dialog-impl>\n          <h2>Header</h2>\n          <div>Dialog body</div>\n          <div class=\"buttons\">\n              <paper-button dialog-dismiss>Cancel</paper-button>\n              <paper-button dialog-confirm>Accept</paper-button>\n          </div>\n      </paper-dialog-impl>\n\n  `paper-dialog-shared-styles.html` provide styles for a header, content area,\n  and an action area for buttons. Use the `<h2>` tag for the header and the\n  `buttons` class for the action area. You can use the `paper-dialog-scrollable`\n  element (in its own repository) if you need a scrolling content area.\n\n  Use the `dialog-dismiss` and `dialog-confirm` attributes on interactive\n  controls to close the dialog. If the user dismisses the dialog with\n  `dialog-confirm`, the `closingReason` will update to include `confirmed:\n  true`.\n\n  ### Accessibility\n\n  This element has `role=\"dialog\"` by default. Depending on the context, it may\n  be more appropriate to override this attribute with `role=\"alertdialog\"`.\n\n  If `modal` is set, the element will prevent the focus from exiting the\n  element. It will also ensure that focus remains in the dialog.\n\n  @hero hero.svg\n  @demo demo/index.html\n  @polymerBehavior PaperDialogBehavior\n */\nexport const PaperDialogBehaviorImpl = {\n\n  hostAttributes: {'role': 'dialog', 'tabindex': '-1'},\n\n  properties: {\n\n    /**\n     * If `modal` is true, this implies `no-cancel-on-outside-click`,\n     * `no-cancel-on-esc-key` and `with-backdrop`.\n     */\n    modal: {type: Boolean, value: false},\n\n    __readied: {type: Boolean, value: false}\n\n  },\n\n  observers: ['_modalChanged(modal, __readied)'],\n\n  listeners: {'tap': '_onDialogClick'},\n\n  /**\n   * @return {void}\n   */\n  ready: function() {\n    // Only now these properties can be read.\n    this.__prevNoCancelOnOutsideClick = this.noCancelOnOutsideClick;\n    this.__prevNoCancelOnEscKey = this.noCancelOnEscKey;\n    this.__prevWithBackdrop = this.withBackdrop;\n    this.__readied = true;\n  },\n\n  _modalChanged: function(modal, readied) {\n    // modal implies noCancelOnOutsideClick, noCancelOnEscKey and withBackdrop.\n    // We need to wait for the element to be ready before we can read the\n    // properties values.\n    if (!readied) {\n      return;\n    }\n\n    if (modal) {\n      this.__prevNoCancelOnOutsideClick = this.noCancelOnOutsideClick;\n      this.__prevNoCancelOnEscKey = this.noCancelOnEscKey;\n      this.__prevWithBackdrop = this.withBackdrop;\n      this.noCancelOnOutsideClick = true;\n      this.noCancelOnEscKey = true;\n      this.withBackdrop = true;\n    } else {\n      // If the value was changed to false, let it false.\n      this.noCancelOnOutsideClick =\n          this.noCancelOnOutsideClick && this.__prevNoCancelOnOutsideClick;\n      this.noCancelOnEscKey =\n          this.noCancelOnEscKey && this.__prevNoCancelOnEscKey;\n      this.withBackdrop = this.withBackdrop && this.__prevWithBackdrop;\n    }\n  },\n\n  _updateClosingReasonConfirmed: function(confirmed) {\n    this.closingReason = this.closingReason || {};\n    this.closingReason.confirmed = confirmed;\n  },\n\n  /**\n   * Will dismiss the dialog if user clicked on an element with dialog-dismiss\n   * or dialog-confirm attribute.\n   */\n  _onDialogClick: function(event) {\n    // Search for the element with dialog-confirm or dialog-dismiss,\n    // from the root target until this (excluded).\n    var path = dom(event).path;\n    for (var i = 0, l = path.indexOf(this); i < l; i++) {\n      var target = path[i];\n      if (target.hasAttribute &&\n          (target.hasAttribute('dialog-dismiss') ||\n           target.hasAttribute('dialog-confirm'))) {\n        this._updateClosingReasonConfirmed(\n            target.hasAttribute('dialog-confirm'));\n        this.close();\n        event.stopPropagation();\n        break;\n      }\n    }\n  }\n\n};\n\n/** @polymerBehavior */\nexport const PaperDialogBehavior =\n    [IronOverlayBehavior, PaperDialogBehaviorImpl];\n","/**\n@license\nCopyright (c) 2015 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\n/*\n### Styling\n\nThe following custom properties and mixins are available for styling.\n\nCustom property | Description | Default\n----------------|-------------|----------\n`--paper-dialog-background-color` | Dialog background color | `--primary-background-color`\n`--paper-dialog-color` | Dialog foreground color | `--primary-text-color`\n`--paper-dialog` | Mixin applied to the dialog | `{}`\n`--paper-dialog-title` | Mixin applied to the title (`<h2>`) element | `{}`\n`--paper-dialog-button-color` | Button area foreground color | `--default-primary-color`\n*/\nimport '@polymer/polymer/polymer-legacy.js';\nimport '@polymer/iron-flex-layout/iron-flex-layout.js';\nimport '@polymer/paper-styles/default-theme.js';\nimport '@polymer/paper-styles/typography.js';\nimport '@polymer/paper-styles/shadow.js';\nconst $_documentContainer = document.createElement('template');\n$_documentContainer.setAttribute('style', 'display: none;');\n\n$_documentContainer.innerHTML = `<dom-module id=\"paper-dialog-shared-styles\">\n  <template>\n    <style>\n      :host {\n        display: block;\n        margin: 24px 40px;\n\n        background: var(--paper-dialog-background-color, var(--primary-background-color));\n        color: var(--paper-dialog-color, var(--primary-text-color));\n\n        @apply --paper-font-body1;\n        @apply --shadow-elevation-16dp;\n        @apply --paper-dialog;\n      }\n\n      :host > ::slotted(*) {\n        margin-top: 20px;\n        padding: 0 24px;\n      }\n\n      :host > ::slotted(.no-padding) {\n        padding: 0;\n      }\n\n      \n      :host > ::slotted(*:first-child) {\n        margin-top: 24px;\n      }\n\n      :host > ::slotted(*:last-child) {\n        margin-bottom: 24px;\n      }\n\n      /* In 1.x, this selector was \\`:host > ::content h2\\`. In 2.x <slot> allows\n      to select direct children only, which increases the weight of this\n      selector, so we have to re-define first-child/last-child margins below. */\n      :host > ::slotted(h2) {\n        position: relative;\n        margin: 0;\n\n        @apply --paper-font-title;\n        @apply --paper-dialog-title;\n      }\n\n      /* Apply mixin again, in case it sets margin-top. */\n      :host > ::slotted(h2:first-child) {\n        margin-top: 24px;\n        @apply --paper-dialog-title;\n      }\n\n      /* Apply mixin again, in case it sets margin-bottom. */\n      :host > ::slotted(h2:last-child) {\n        margin-bottom: 24px;\n        @apply --paper-dialog-title;\n      }\n\n      :host > ::slotted(.paper-dialog-buttons),\n      :host > ::slotted(.buttons) {\n        position: relative;\n        padding: 8px 8px 8px 24px;\n        margin: 0;\n\n        color: var(--paper-dialog-button-color, var(--primary-color));\n\n        @apply --layout-horizontal;\n        @apply --layout-end-justified;\n      }\n    </style>\n  </template>\n</dom-module>`;\n\ndocument.head.appendChild($_documentContainer.content);\n","import { dedupingMixin } from '@polymer/polymer/lib/utils/mixin.js';\nimport { PaperDialogBehavior } from '@polymer/paper-dialog-behavior/paper-dialog-behavior.js';\nimport { mixinBehaviors } from '@polymer/polymer/lib/legacy/class.js';\nimport EventsMixin from './events-mixin';\n/**\n * @polymerMixin\n * @appliesMixin EventsMixin\n * @appliesMixin PaperDialogBehavior\n */\nexport default dedupingMixin(superClass =>\n  class extends mixinBehaviors([EventsMixin, PaperDialogBehavior], superClass) {\n    static get properties() {\n      return {\n        withBackdrop: {\n          type: Boolean,\n          value: true,\n        },\n      };\n    }\n  });\n","import '@polymer/iron-icon/iron-icon.js';\nimport '@polymer/paper-dialog-behavior/paper-dialog-shared-styles.js';\nimport '@polymer/paper-icon-button/paper-icon-button.js';\nimport { html } from '@polymer/polymer/lib/utils/html-tag.js';\nimport { PolymerElement } from '@polymer/polymer/polymer-element.js';\n\nimport DialogMixin from '../mixins/dialog-mixin.js';\n\n/*\n * @appliesMixin DialogMixin\n */\nclass HaVoiceCommandDialog extends DialogMixin(PolymerElement) {\n  static get template() {\n    return html`\n    <style include=\"paper-dialog-shared-styles\">\n      iron-icon {\n        margin-right: 8px;\n      }\n\n      .content {\n        width: 450px;\n        min-height: 80px;\n        font-size: 18px;\n        padding: 16px;\n      }\n\n      .messages {\n        max-height: 50vh;\n        overflow: auto;\n      }\n\n      .messages::after {\n        content: \"\";\n        clear: both;\n        display: block;\n      }\n\n      .message {\n        clear: both;\n        margin: 8px 0;\n        padding: 8px;\n        border-radius: 15px;\n      }\n\n      .message.user {\n        margin-left: 24px;\n        float: right;\n        text-align: right;\n        border-bottom-right-radius: 0px;\n        background-color: var(--light-primary-color);\n        color: var(--primary-text-color);\n      }\n\n      .message.hass {\n        margin-right: 24px;\n        float: left;\n        border-bottom-left-radius: 0px;\n        background-color: var(--primary-color);\n        color: var(--text-primary-color);\n      }\n\n      .message.error {\n        background-color: var(--google-red-500);\n        color: var(--text-primary-color);\n      }\n\n      .icon {\n        text-align: center;\n      }\n\n      .icon paper-icon-button {\n        height: 52px;\n        width: 52px;\n      }\n\n      .interimTranscript {\n        color: darkgrey;\n      }\n\n      [hidden] {\n        display: none;\n      }\n\n      :host {\n        border-radius: 2px;\n      }\n\n      @media all and (max-width: 450px) {\n        :host {\n          margin: 0;\n          width: 100%;\n          max-height: calc(100% - 64px);\n\n          position: fixed !important;\n          bottom: 0px;\n          left: 0px;\n          right: 0px;\n          overflow: scroll;\n          border-bottom-left-radius: 0px;\n          border-bottom-right-radius: 0px;\n        }\n\n        .content {\n          width: auto;\n        }\n\n        .messages {\n          max-height: 68vh;\n        }\n      }\n    </style>\n\n    <div class=\"content\">\n      <div class=\"messages\" id=\"messages\">\n        <template is=\"dom-repeat\" items=\"[[_conversation]]\" as=\"message\">\n          <div class$=\"[[_computeMessageClasses(message)]]\">[[message.text]]</div>\n        </template>\n      </div>\n      <template is=\"dom-if\" if=\"[[results]]\">\n        <div class=\"messages\">\n          <div class=\"message user\">\n            <span>{{results.final}}</span>\n            <span class=\"interimTranscript\">[[results.interim]]</span>\n            …\n          </div>\n        </div>\n      </template>\n      <div class=\"icon\" hidden$=\"[[results]]\">\n        <paper-icon-button icon=\"hass:text-to-speech\" on-click=\"startListening\"></paper-icon-button>\n      </div>\n    </div>\n`;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n      results: {\n        type: Object,\n        value: null,\n        observer: '_scrollMessagesBottom',\n      },\n\n      _conversation: {\n        type: Array,\n        value: function () {\n          return [{ who: 'hass', text: 'How can I help?' }];\n        },\n        observer: '_scrollMessagesBottom',\n      }\n    };\n  }\n\n  static get observers() { return ['dialogOpenChanged(opened)']; }\n\n  initRecognition() {\n    /* eslint-disable new-cap */\n    this.recognition = new webkitSpeechRecognition();\n    /* eslint-enable new-cap */\n\n    this.recognition.onstart = function () {\n      this.results = {\n        final: '',\n        interim: '',\n      };\n    }.bind(this);\n    this.recognition.onerror = function () {\n      this.recognition.abort();\n      var text = this.results.final || this.results.interim;\n      this.results = null;\n      if (text === '') {\n        text = '<Home Assistant did not hear anything>';\n      }\n      this.push('_conversation', { who: 'user', text: text, error: true });\n    }.bind(this);\n    this.recognition.onend = function () {\n      // Already handled by onerror\n      if (this.results == null) {\n        return;\n      }\n      var text = this.results.final || this.results.interim;\n      this.results = null;\n      this.push('_conversation', { who: 'user', text: text });\n\n      this.hass.callApi('post', 'conversation/process', { text: text })\n        .then(function (response) {\n          this.push('_conversation', { who: 'hass', text: response.speech.plain.speech });\n        }.bind(this), function () {\n          this.set(['_conversation', this._conversation.length - 1, 'error'], true);\n        }.bind(this));\n    }.bind(this);\n\n    this.recognition.onresult = function (event) {\n      var oldResults = this.results;\n      var finalTranscript = '';\n      var interimTranscript = '';\n\n      for (var ind = event.resultIndex; ind < event.results.length; ind++) {\n        if (event.results[ind].isFinal) {\n          finalTranscript += event.results[ind][0].transcript;\n        } else {\n          interimTranscript += event.results[ind][0].transcript;\n        }\n      }\n\n      this.results = {\n        interim: interimTranscript,\n        final: oldResults.final + finalTranscript,\n      };\n    }.bind(this);\n  }\n\n  startListening() {\n    if (!this.recognition) {\n      this.initRecognition();\n    }\n\n    this.results = {\n      interim: '',\n      final: '',\n    };\n    this.recognition.start();\n  }\n\n  _scrollMessagesBottom() {\n    setTimeout(() => {\n      this.$.messages.scrollTop = this.$.messages.scrollHeight;\n\n      if (this.$.messages.scrollTop !== 0) {\n        this.$.dialog.fire('iron-resize');\n      }\n    }, 10);\n  }\n\n  dialogOpenChanged(newVal) {\n    if (newVal) {\n      this.startListening();\n    } else if (!newVal && this.results) {\n      this.recognition.abort();\n    }\n  }\n\n  _computeMessageClasses(message) {\n    return 'message ' + message.who + (message.error ? ' error' : '');\n  }\n}\n\ncustomElements.define('ha-voice-command-dialog', HaVoiceCommandDialog);\n"],"sourceRoot":""}