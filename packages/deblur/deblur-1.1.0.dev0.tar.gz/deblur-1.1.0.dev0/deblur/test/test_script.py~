from unittest import TestCase, main
from shutil import rmtree
from tempfile import mkdtemp
from os import listdir, remove
from types import GeneratorType
from os.path import join, isfile, abspath, dirname, splitext

from skbio import DNA

from biom import load_table
import logging
import os

from deblur.workflow import (dereplicate_seqs,
                             remove_chimeras_denovo_from_seqs,
                             remove_artifacts_seqs,
                             create_otu_table,
                             get_files_for_table,
                             trim_seqs,
                             multiple_sequence_alignment,
                             launch_workflow,
                             split_sequence_file_on_sample_ids_to_files,
                             build_index_sortmerna,
                             start_log, sequence_generator,
                             sample_id_from_read_id,
                             remove_artifacts_from_biom_table,
                             filter_minreads_samples_from_table)
from deblur.deblurring import get_default_error_profile

import click
from click.testing import CliRunner
from scripts.deblur import workflow


class TestScript(unittest.TestCase):

    def setUp(self):
        self.seqs_fp = 'simset.s3.fasta'
        self.output_dir = 'tmp'
        self.trim_length = 150

    def tearDown(self):
        os.rmdir(self.output_dir)

    def test_workflow(self):
        runner = CliRunner()
        result = runner.invoke(workflow,
                               seqs_fp=self.seqs_fp,
                               output_fp=self.output_dir)


if __name__ == "__main__":
    unittest.main()

