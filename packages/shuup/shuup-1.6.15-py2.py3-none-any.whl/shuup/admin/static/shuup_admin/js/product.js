"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],i=!0,r=!1,n=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(a.push(o.value),!t||a.length!==t);i=!0);}catch(e){r=!0,n=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw n}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};$(function(){function i(e,t){t.xhr&&(t=JSON.parse(t.xhr.responseText).file),function(e,t){var a=e.attr("id"),i=$("#"+a+" .panel").length,r=$("#"+a+"-placeholder-panel"),n=$(r.html().replace(/__prefix__/g,i-1).replace(/__prefix_name__/g,i)),o="id_images";if(0<a.indexOf("media")&&(o="id_media"),t){var s=$("<a href='"+t.url+"' target='_blank'></a>");"id_images"===o?s.append("<img src='"+t.url+"'>"):s.append("<br><p>"+t.name+"</p>"),n.find(".thumbnail").append(s),n.find(".file-control").find("input").val(t.id)}n.insertBefore(r)}(e,t)}$(".product-media-delete").on("click",function(e){e.preventDefault(),confirm(gettext("Are you sure you want to delete this media?"))&&($(this).parents(".panel").fadeOut(),$(this).next(".hide").find("input").prop("checked",!0))}),$(document).on("click",".set-as-primary",function(e){e.preventDefault();var t=$(this).parents(".panel"),a=t.data("prefix").split("-"),i=_slicedToArray(a,2)[1],r=$("#product-images-section .panel");r.removeClass("panel-selected").addClass("panel-default"),$(".is-primary-image").replaceWith(function(){return $("<a>",{class:"set-as-primary",href:"#"}).text(gettext("Set as primary image"))}),r.each(function(e){$("#id_images-"+e+"-is_primary").prop("checked",!1)}),$(this).replaceWith(function(){return $("<span>",{class:"is-primary-image"}).text(gettext("Primary image"))}),t.addClass("panel-selected"),$("#id_images-"+i+"-is_primary").prop("checked",!0)});[{field:"product-images-section",targetPath:"/products/images",maxFiles:10,queueComplete:"images"},{field:"product-media-section",targetPath:"/products/media",maxFiles:10,queueComplete:"media"}].forEach(function(t){var e="#"+t.field+"-dropzone";if($(e).length){var a=window.ShuupAdminConfig.browserUrls.media;activateDropzone($(e),{url:a+"?action=upload&path="+t.targetPath,maxFiles:t.maxFiles,onSuccess:function(e){i($("#"+t.field),e)},onQueueComplete:function(){!function(e,t){if(!(0<location.pathname.indexOf("new"))){for(var a=$("#product-"+t+"-section-dropzone").data().product_id,i=$("#product-"+t+"-section").find(".file-control input"),r=[],n=0;n<i.length;n++){var o=parseInt($(i[n]).val());isNaN(o)||r.push(parseInt($(i[n]).val()))}$.ajax({url:"/sa/products/"+a+"/media/add/",method:"POST",data:{csrfmiddlewaretoken:ShuupAdminConfig.csrf,product_id:a,file_ids:r,kind:t},traditional:!0,success:function(e){window.Messages.enqueue({tags:"success",text:e.message})},error:function(e){alert("ERROR")}})}}(0,t.queueComplete)}})}})});
//# sourceMappingURL=product.js.map
