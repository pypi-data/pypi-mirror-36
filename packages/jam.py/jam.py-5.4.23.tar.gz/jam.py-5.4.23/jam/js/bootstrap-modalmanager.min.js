!function(a){"use strict";var b=function(a,b){this.init(a,b);};b.prototype={constructor:b,init:function(b,c){var d=this;this.$element=a(b);this.options=a.extend({},a.fn.modalmanager.defaults,this.$element.data(),typeof c=='object'&&c);this.stack=[];this.backdropCount=0;if(this.options.resize){var e;a(window).on('resize.modal',function(){e&&clearTimeout(e);e=setTimeout(function(){for(var a=0;a<d.stack.length;a++)d.stack[a].isShown&&d.stack[a].layout();},100);});}},createModal:function(b,c){a(b).modal(a.extend({manager:this},c));},topModal:function(){var a,b;for(var a=0;a<this.stack.length;a++)if(this.stack[a].isShown)b=this.stack[a];return b;},appendModal:function(b){var c=this,e,f=this.topModal();if(!f)this.activeElement=a(':focus').get(0);b.zPos=this.getMaxzPos()+1;this.stack.push(b);b.$element.on('show.modalmanager',d(function(d){var e=function(){b.isShown=true;var d=a.support.transition&&b.$element.hasClass('fade');c.$element.toggleClass('modal-open',c.hasOpenModal()).toggleClass('page-overflow',a(window).height()<c.$element.height());b.$parent=b.$element.parent();b.$container=c.createContainer(b);b.$element.appendTo(b.$container);b.layout();c.backdrop(b,function(){b.$element.show();if(d)b.$element[0].offsetWidth;b.$element.addClass('in').attr('aria-hidden',false);var e=function(){c.setFocus(b.$element);b.$element.trigger('shown');};d?b.$element.one(a.support.transition.end,e):e();});};b.options.replace?c.replace(e):e();}));b.$element.on('hidden.modalmanager',d(function(d){c.backdrop(b);if(b.$backdrop)a.support.transition&&b.$element.hasClass('fade')?b.$backdrop.one(a.support.transition.end,function(){c.destroyModal(b);}):c.destroyModal(b);else c.destroyModal(b);}));b.$element.on('destroy.modalmanager',d(function(a){c.removeModal(b);}));},destroyModal:function(a){var b=this,c;a.destroy();var d=this.hasOpenModal();this.$element.toggleClass('modal-open',d);if(!d)this.$element.removeClass('page-overflow');this.removeContainer(a);c=setTimeout(function(){b.restoreFocus();},0);},hasOpenModal:function(){for(var a=0;a<this.stack.length;a++)if(this.stack[a].isShown)return true;return false;},restoreFocus:function(){var b;for(var c=0;c<this.stack.length;c++)if(this.stack[c].isShown)b=this.stack[c];if(b)b.restoreFocus();else a(this.activeElement).focus();},setFocus:function(b){setTimeout(function(){var c=a(document.activeElement);if(c.closest('.modal').get(0)!==b.get(0))b.focus();},0);},removeModal:function(a){a.$element.off('.modalmanager');if(a.$backdrop)this.removeBackdrop(a);this.stack.splice(this.getIndexOfModal(a),1);},getModalAt:function(a){return this.stack[a];},getIndexOfModal:function(a){for(var b=0;b<this.stack.length;b++)if(a===this.stack[b])return b;},getMaxzPos:function(){var a=0;for(var b=0;b<this.stack.length;b++)if(this.stack[b].zPos>a)a=this.stack[b].zPos;return a;},replace:function(b){var c;for(var e=0;e<this.stack.length;e++)if(this.stack[e].isShown)c=this.stack[e];if(c){this.$backdropHandle=c.$backdrop;c.$backdrop=null;b&&c.$element.one('hidden',d(a.proxy(b,this)));c.hide();}else if(b)b();},removeBackdrop:function(a){a.$backdrop.remove();a.$backdrop=null;},createBackdrop:function(b){var c;if(!this.$backdropHandle)c=a('<div class="modal-backdrop '+b+'" />').appendTo(this.$element);else{c=this.$backdropHandle;c.off('.modalmanager');this.$backdropHandle=null;this.isLoading&&this.removeSpinner();}return c;},removeContainer:function(a){a.$container.remove();a.$container=null;},createContainer:function(b){var e;e=a('<div class="modal-scrollable">').css('z-index',c('modal',b.zPos)).appendTo(this.$element);if(b&&b.options.backdrop!='static')e.on('click.modal',d(function(a){b.hide();}));else if(b)e.on('click.modal',d(function(a){b.attention();}));return e;},backdrop:function(b,d){var e=b.$element.hasClass('fade')?'fade':'',f=b.options.backdrop&&this.backdropCount<this.options.backdropLimit;if(b.isShown&&f){var g=a.support.transition&&e&&!this.$backdropHandle;b.$backdrop=this.createBackdrop(e);b.$backdrop.css('z-index',c('backdrop',b.zPos));if(g)b.$backdrop[0].offsetWidth;b.$backdrop.addClass('in');this.backdropCount+=1;g?b.$backdrop.one(a.support.transition.end,d):d();}else if(!b.isShown&&b.$backdrop){b.$backdrop.removeClass('in');this.backdropCount-=1;var h=this;a.support.transition&&b.$element.hasClass('fade')?b.$backdrop.one(a.support.transition.end,function(){h.removeBackdrop(b);}):h.removeBackdrop(b);}else if(d)d();},removeSpinner:function(){this.$spinner&&this.$spinner.remove();this.$spinner=null;this.isLoading=false;},removeLoading:function(){this.$backdropHandle&&this.$backdropHandle.remove();this.$backdropHandle=null;this.removeSpinner();},loading:function(b){b=b||function(){};this.$element.toggleClass('modal-open',!this.isLoading||this.hasOpenModal()).toggleClass('page-overflow',a(window).height()<this.$element.height());if(!this.isLoading){this.$backdropHandle=this.createBackdrop('fade');this.$backdropHandle[0].offsetWidth;this.$backdropHandle.css('z-index',c('backdrop',this.stack.length)).addClass('in');var d=a(this.options.spinner).css('z-index',c('modal',this.stack.length)).appendTo(this.$element).addClass('in');this.$spinner=a(this.createContainer()).append(d).on('click.modalmanager',a.proxy(this.loading,this));this.isLoading=true;a.support.transition?this.$backdropHandle.one(a.support.transition.end,b):b();}else if(this.isLoading&&this.$backdropHandle){this.$backdropHandle.removeClass('in');var e=this;a.support.transition?this.$backdropHandle.one(a.support.transition.end,function(){e.removeLoading();}):e.removeLoading();}else if(b)b(this.isLoading);},elzIndex:function(b){var c=0,d;if(b&&b.parentNode){d=b.parentNode;while(d){if(d.className&&d.className==='modal-scrollable')c=a(d).css('z-index');d=d.parentNode;}}return c;}};var c=(function(){var b,c={};return function(d,e){if(typeof b==='undefined'){var f=a('<div class="modal hide" />').appendTo('body'),g=a('<div class="modal-backdrop hide" />').appendTo('body');c.modal=+f.css('z-index');c.backdrop=+g.css('z-index');b=c.modal-c.backdrop;f.remove();g.remove();g=f=null;}return c[d]+(b*e);};}());function d(a){return function(b){if(this===b.target)return a.apply(this,arguments);};}a.fn.modalmanager=function(c,d){return this.each(function(){var e=a(this),f=e.data('modalmanager');if(!f)e.data('modalmanager',(f=new b(this,c)));if(typeof c==='string')f[c].apply(f,[].concat(d));});};a.fn.modalmanager.defaults={backdropLimit:999,resize:true,spinner:'<div class="loading-spinner fade" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>'};a.fn.modalmanager.Constructor=b;var e=a('body').data('modalmanager');if(!e)e=a('body').modalmanager().data('modalmanager');a(window).on('keydown.modalmanager keyup.modalmanager keypress.modalmanager',function(a){var b=e.topModal();if(b&&a.target)if(e.elzIndex(a.target)<b.zIndex){a.stopImmediatePropagation();a.stopPropagation();a.preventDefault();b.restoreFocus();}});}(jQuery);