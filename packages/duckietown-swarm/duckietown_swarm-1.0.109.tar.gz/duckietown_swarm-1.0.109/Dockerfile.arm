FROM duckietown/rpi-duckiebot-base

ENV refreshed_ON=20180609
RUN apt-get update

ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get install -y dialog apt-utils

RUN apt-get install -y\
    software-properties-common \
    gnupg \
    curl \
    git \
    git-extras \
    ssh \
    pdftk \
    bibtex2html \
    libxml2-dev \
    libxslt1-dev \
    libffi6 \
    libffi-dev \
    libxml2-dev \
    libxslt1-dev \
    pdftk \
    bibtex2html \
    build-essential \
    graphviz \
    idle \
    virtualenv \
    python-pmw \
    python-imaging \
    python-yaml \
    python-dev \
    python-matplotlib \
    python-numpy \
    python-matplotlib \
    python-setproctitle \
    python-psutil \
    python-lxml \
    python-pillow \
    python-matplotlib \
    python-pip \
    python-tk \
    python-scipy \
    python-frozendict \
    python-tables \
    python-sklearn \
    python-termcolor \
    python-setproctitle \
    python-psutil\
    byobu \
    atop \
    htop \
    imagemagick \
    graphviz \
    ghostscript \
    ntpdate  \
    libatlas-base-dev \
    vim\
    apt-file\
    iftop


RUN wget https://dist.ipfs.io/go-ipfs/v0.4.17/go-ipfs_v0.4.17_linux-arm.tar.gz
RUN tar xvzf go-ipfs_v0.4.17_linux-arm.tar.gz
RUN cp go-ipfs/ipfs /usr/bin
RUN ipfs version

COPY requirements.txt  /project/requirements.txt
RUN pip install -r /project/requirements.txt

COPY src /project/src
COPY setup.py /project/setup.py
RUN cd /project && python setup.py install

ENV DISABLE_CONTRACTS=1
CMD dt-swarm daemon --low-power
