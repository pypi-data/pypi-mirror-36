{% load edc_dashboard_extras %}
{% load tz %}
{% load static %}
{% load edc_base_extras %}

<div class="panel">  
<!-- begin table -->
<div class="table-responsive">
<table class="table table-condensed table-hover small">
<thead>

    <!-- begin results header -->
    <th>AE TMG Reports</th>
    <!-- end results header -->

</thead><tbody>

{% if not results %}
    <tr> 
    <td>
        <div class="alert alert-success">
            <h6><i class="fas fa-thumbs-up fa-lg"></i> {{ empty_message }}</h6>
        </div>
    </td>
    </tr>
{% endif %}

{% for result in results %}
    <tr> 
    <td>
        <div class="panel panel-default">
            <div class="panel-heading"><H5><span class="badge">{{ forloop.counter }}</span> {{ result.subject_identifier }}  <i><span class="text text-muted small">{{ utc_date|timeuntil:result.report_date }} ago</span></i></H5></div>
        <div class="row">
            <div class="col-md-4">
            <div class="list-group">
                {% if result.has_reference_obj_permissions %}
                    <a class="list-group-item list-group-item-{% if result.reference_obj %}success{% else%}warning{% endif %}"
                    title="{% if result.reference_obj %}Edit{% else %}Add{% endif %} {{result.reference_model_name}}"
                    role="button"
                    id="reference_obj-{{forloop.counter}}"
                    href="{{ result.reference_url }}">
                    {% if result.reference_obj %}<i class="fas fa-pencil-alt fa-fw"></i> {% else %}<i class="fas fa-plus fa-fw"></i> {% endif %}
                    {{ result.reference_model_name|default:'New' }}</a>
                {% else %}
                    <div class="list-group-item list-group-item-success">
                        {{ result.reference_model_name }}
                    </div>
                    <div class="list-group-item">
                        <i>May only be viewed by {{ result.reference_obj.user_created }}</i>
                    </div>
                {% endif %}
            <div class="list-group-item"><b>Created:</b> {{ result.reference_obj.user_created|default:"---" }}&nbsp;{{ result.reference_obj.created|date:"SHORT_DATETIME_FORMAT"|default:"---" }}</div>
            <div class="list-group-item"><b>Last modified:</b> {{ result.reference_obj.user_modified|default:"---" }}&nbsp;{{ result.reference_obj.modified|date:"SHORT_DATETIME_FORMAT"|default:"---" }}</div>
            </div>
        </div>

        <div class="col-md-4">

        <div class="list-group">

            {% if result.parent_reference_obj %}
                {% if result.has_parent_reference_obj_permissions %}
                <a class="list-group-item list-group-item-{% if 'TMG' in result.parent_reference_model_name %}success{% else%}info{% endif %}" role="button"
                    title="View {{ result.parent_reference_model_name}}"
                    id="parent_reference_obj-{{forloop.counter}}"
                    href="{{ result.parent_reference_url }}">
                    {% if 'TMG' in result.parent_reference_model_name %} <i class="fas fa-pencil-alt fa-fw"></i>{% else %}<i class="fas fa-eye fa-fw"></i>{% endif %} 
                     {{ result.parent_reference_model_name }}
                </a>
                {% else %}
                <div class="list-group-item list-group-item-info">
                    {{ result.parent_reference_model_name }}
                </div>
                <div class="list-group-item">
                    <i>May not be viewed by {{ user }}</i>
                </div>
                {% endif %}
                <div class="list-group-item"><b>Created:</b> {{ result.parent_reference_obj.user_created|default:"---" }}&nbsp;{{ result.parent_reference_obj.created|date:"SHORT_DATETIME_FORMAT"|default:"---" }}</div>
                <div class="list-group-item"><b>Last modified:</b> {{ result.parent_reference_obj.user_modified|default:"---" }}&nbsp;{{ result.parent_reference_obj.modified|date:"SHORT_DATETIME_FORMAT"|default:"---" }}</div>
            {% endif %}    

            {% if result.related_reference_obj and result.parent_reference_obj.action_identifier !=  result.related_reference_obj.action_identifier %}
                {% if result.has_parent_reference_obj_permissions %}
                    <a class="list-group-item list-group-item-{% if 'TMG' in result.related_reference_model_name %}success{% else%}info{% endif %}" role="button"
                    title="View {{ result.related_reference_model_name }}"
                    id="related_reference_obj-{{forloop.counter}}"
                    href="{{ result.related_reference_url }}">
                    {% if 'TMG' in result.related_reference_model_name %} <i class="fas fa-pencil-alt fa-fw"></i>{% else %}<i class="fas fa-eye fa-fw"></i>{% endif %} 
                    {{result.related_reference_model_name }}</a>
                {% else %}
                    <div class="list-group-item list-group-item-info">
                        {{ result.related_reference_model_name }}
                    </div>
                    <div class="list-group-item">
                        <i>May not be viewed by {{ user }}</i>
                    </div>
                {% endif %}
                <div class="list-group-item"><b>Created:</b> {{ result.related_reference_obj.user_created|default:"---" }}&nbsp;{{ result.related_reference_obj.created|date:"SHORT_DATETIME_FORMAT"|default:"---" }}</div>
                <div class="list-group-item"><b>Last modified:</b> {{ result.related_reference_obj.user_modified|default:"---" }}&nbsp;{{ result.related_reference_obj.modified|date:"SHORT_DATETIME_FORMAT"|default:"---" }}</div>
            {% endif %}
            
        </div>


        </div>

        <div class="col-md-4">
            
            
            {% if result.parent_reference_obj.action_identifier != result.related_reference_obj.action_identifier%}
            {% for obj in result.parent_reference_obj.ae_follow_ups %}
                <a class="list-group-item list-group-item-info" role="button"
                title="View {{ obj }}"
                href="{{ obj.get_absolute_url }}">
                <i class="fas fa-eye fa-fw"></i> AE Followup {{ obj }} <span class="text text-muted">{{ utc_date|timeuntil:obj.report_date }}</span></a>
            {% endfor %}
            {% endif %}

            {% for obj in result.related_reference_obj.ae_follow_ups %}
                <a class="list-group-item list-group-item-info" role="button"
                title="View {{ obj }}"
                href="{{ obj.get_absolute_url }}">
                <i class="fas fa-eye fa-fw"></i> AE Followup {{ obj }} <span class="text text-muted">{{ utc_date|timeuntil:obj.report_date }}</span></a>
            {% endfor %}

            {% if not result.parent_reference_obj.ae_follow_ups and not result.related_reference_obj.ae_follow_ups%}
                <div class="list-group-item">There are no follow-ups to this AE</div>
            {% endif %}

            <a class="list-group-item list-group-item-default" role="button" 
            title="to subject dashboard"
            href="{% url subject_dashboard_url subject_identifier=result.subject_identifier  %}">
            <i class="fas fa-user-circle fa-sm"></i> Subject Dashboard  <i class="fas fa-share"></i></a>

        </div>
        </div>
        </div>
    </td>
    </tr>                       

{% endfor %}

</tbody></table>

<!-- begin spacer rows -->
<table>
<tr><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td></tr>
</table>
<!-- end spacer rows -->

</div><!-- end table -->

{% paginator_row %}

</div>  <!--end panel -->
<!-- end listboard main block -->